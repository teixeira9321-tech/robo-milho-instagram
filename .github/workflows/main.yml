name: "ğŸš€ Motor de Elite - Milho Premium"

on:
  schedule:
    # HorÃ¡rios de disparo (Brasil): 07:00, 14:00 e 20:00 (UTC)
    # Nota: O GitHub usa UTC. 07 UTC = 04:00 BRT. Ajuste conforme necessidade.
    - cron: '0 7,14,20 * * *'
  workflow_dispatch:
    inputs:
      debug_mode:
        description: 'Modo de Teste Manual'
        required: false
        default: 'false'

# PERMISSÃƒO CRÃTICA: Autoriza o robÃ´ a salvar arquivos no repositÃ³rio
permissions:
  contents: write

jobs:
  execucao-alta-performance:
    name: "Processamento de MÃ­dia e IA"
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: "ğŸ“‚ Sincronizando RepositÃ³rio"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Garante histÃ³rico completo para evitar erros no git push

      - name: "ğŸ Setup Python Otimizado"
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: "ğŸ“¦ InjeÃ§Ã£o de DependÃªncias"
        run: |
          python -m pip install --upgrade pip
          pip install instagrapi requests google-genai pillow

      - name: "âš™ï¸ AtivaÃ§Ã£o do Motor Inteligente"
        env:
          INSTA_SESSION: ${{ secrets.INSTA_SESSION }}
          GEMINI_KEY: ${{ secrets.GEMINI_KEY }}
          PYTHONUNBUFFERED: 1
        run: |
          echo "ğŸš€ Iniciando ciclo de postagem..."
          python main.py
          echo "âœ… Script Python finalizado."

      # --- NOVIDADE: SALVAMENTO AUTOMÃTICO ---
      - name: "ğŸ’¾ Salvar AlteraÃ§Ãµes (Mover Arquivos)"
        if: success() # SÃ³ roda se o Python nÃ£o deu erro
        run: |
          echo "âš™ï¸ Configurando identidade do robÃ´..."
          git config --global user.name 'Motor Elite Bot'
          git config --global user.email 'bot@milhopremium.com'
          
          echo "ğŸ“‚ Verificando mudanÃ§as nas pastas..."
          git add conteudo_novo/*
          git add conteudo_postado/*
          
          # Verifica se tem algo pra salvar. Se tiver, faz o commit e o push.
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ¤– [AUTO] MÃ­dia processada e movida" && git push)
          echo "âœ… RepositÃ³rio atualizado com sucesso!"

      - name: "ğŸ“Š RelatÃ³rio Final"
        if: always()
        run: |
          echo "Ciclo encerrado em: $(date)"
